server:
  port: 48080

# ========== Nacos 配置 ==========
nacos:
  discovery:
    enabled: false
  config:
    enabled: false
    server-addr: ${nacos_server_addr:172.16.9.88:18848}
    namespace: ${nacos_namespace:bf644fca-1276-415a-89de-428331e96a46}
    data-ids: ${nacos_data_ids:zhgd-workflow-service,workflow-common}
    group: ${nacos_group:workflow}
    max-retry: 10
    type: properties
    auto-refresh: false
    bootstrap:
      enable: false
      log-enable: false
    username: ${nacos_username:nacos}
    password: ${nacos_password:sHL4RErzeB@kJMVnXPKfh9j}

# ========== Dubbo 配置 ==========
dubbo:
  application:
    id: gddnTunnelMonitor
    name: gddnTunnelMonitor
  protocol:
    port: 20804
  consumer:
    group: pms_k8s_test05
  provider:
    group: pms_k8s_test05
  registry:
    address: zookeeper://172.16.8.125:2181?client=curator&timeout=60000

# ========== Spring 核心配置 ==========
spring:
  # 自动配置排除
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.quartz.QuartzAutoConfiguration # 禁用 Quartz 自动配置
      - org.springframework.ai.vectorstore.qdrant.autoconfigure.QdrantVectorStoreAutoConfiguration # 禁用 AI Qdrant
      - org.springframework.ai.vectorstore.milvus.autoconfigure.MilvusVectorStoreAutoConfiguration # 禁用 AI Milvus
      - com.alibaba.cloud.nacos.NacosAutoConfiguration # 禁用 Nacos 核心自动配置
      - com.alibaba.cloud.nacos.config.NacosConfigAutoConfiguration # 禁用 Nacos 配置自动配置

  # Nacos 校验关闭（核心）
  cloud:
    nacos:
      config:
        import-check:
          enabled: false # 关闭 Nacos 配置导入强制检查
        enabled: false
      discovery:
        enabled: false
  config:
    import-check:
      enabled: false # 关闭所有配置导入检查

  # ========== Redis 配置（远程连接） ==========
  redis:
    host: 172.16.9.201 # 远程 Redis IP
    port: 6379 # 端口
    password: "" # 无密码留空，有密码则填写
    database: 0 # 数据库索引
    timeout: 5000ms # 连接超时时间
    lettuce:
      pool:
        max-active: 8 # 最大连接数
        max-wait: -1ms # 最大等待时间
        max-idle: 8 # 最大空闲连接数
        min-idle: 0 # 最小空闲连接数

  # ========== 数据源配置（修复动态数据源格式） ==========
  datasource:
    # Druid 监控全局配置
    druid:
      web-stat-filter:
        enabled: true
      stat-view-servlet:
        enabled: true
        allow: "" # 允许所有访问
        url-pattern: /druid/*
        login-username: "" # 控制台账号（空则无需登录）
        login-password: "" # 控制台密码
      filter:
        stat:
          enabled: true
          log-slow-sql: true
          slow-sql-millis: 100
          merge-sql: true
        wall:
          config:
            multi-statement-allow: true
    # 动态数据源核心配置（修复 Druid 层级 + 补充驱动类）
    dynamic:
      primary: master # 默认数据源
      strict: false # 关闭严格模式，兼容占位符
      datasource:
        master:
          url: ${common.datasource.mysql.workflow.url:jdbc:mysql://172.16.8.18:3306/workflow?connectTimeout=30000&socketTimeout=60000&serverTimezone=Asia/Shanghai&useUnicode=true&characterEncoding=utf-8&useSSL=false&autoReconnect=true}
          username: ${common.datasource.mysql.workflow.username:zzsa}
          password: ${common.datasource.mysql.workflow.password:RymQLf8Vq7gxiLlIJjz1}
          driver-class-name: com.mysql.cj.jdbc.Driver # 必须配置 MySQL 驱动类
          # Druid 连接池配置（嵌套到 master 数据源内）
          druid:
            initial-size: 1 # 初始连接数
            min-idle: 1 # 最小连接池数量
            max-active: 20 # 最大连接池数量
            max-wait: 60000 # 获取连接超时时间（毫秒）
            time-between-eviction-runs-millis: 60000 # 空闲连接检测间隔
            min-evictable-idle-time-millis: 600000 # 连接最小生存时间
            max-evictable-idle-time-millis: 1800000 # 连接最大生存时间
            validation-query: SELECT 1 FROM DUAL # 检测连接有效性
            test-while-idle: true
            test-on-borrow: false
            test-on-return: false
            pool-prepared-statements: true # 开启 PreparedStatement 缓存
            max-pool-prepared-statement-per-connection-size: 20 # 缓存数量

  # ========== Quartz 定时任务配置 ==========
  quartz:
    auto-startup: true
    scheduler-name: schedulerName
    job-store-type: jdbc
    wait-for-jobs-to-complete-on-shutdown: true
    properties:
      org:
        quartz:
          scheduler:
            instanceName: schedulerName
            instanceId: AUTO
          jobStore:
            class: org.springframework.scheduling.quartz.LocalDataSourceJobStore
            isClustered: true
            clusterCheckinInterval: 15000
            misfireThreshold: 60000
          threadPool:
            threadCount: 25
            threadPriority: 5
            class: org.quartz.simpl.SimpleThreadPool
    jdbc:
      initialize-schema: NEVER

  # ========== 消息队列配置 ==========
  rabbitmq:
    host: 127.0.0.1
    port: 5672
    username: rabbit
    password: rabbit
  kafka:
    bootstrap-servers: 127.0.0.1:9092

  # ========== Spring Boot Admin 配置 ==========
  boot:
    admin:
      client:
        url: http://127.0.0.1:${server.port}/${spring.boot.admin.context-path}
        instance:
          service-host-type: IP
      context-path: /admin

# ========== Redisson 配置（和 Redis 保持一致） ==========
redisson:
  singleServerConfig:
    address: redis://${spring.redis.host}:${spring.redis.port}
    password: ${spring.redis.password}
    database: ${spring.redis.database}
    timeout: ${spring.redis.timeout}
    connectionPoolSize: ${spring.redis.lettuce.pool.max-active}
    connectionMinimumIdleSize: ${spring.redis.lettuce.pool.min-idle}
  threads: 16
  nettyThreads: 32
  codec:
    class: org.redisson.codec.JsonJacksonCodec

# ========== RocketMQ 配置 ==========
rocketmq:
  name-server: 127.0.0.1:9876

# ========== Lock4j 分布式锁配置 ==========
lock4j:
  acquire-timeout: 3000
  expire: 30000

# ========== 监控配置 ==========
management:
  endpoints:
    web:
      base-path: /actuator
      exposure:
        include: '*'

# ========== 日志配置 ==========
logging:
  file:
    name: ${user.home}/logs/${spring.application.name}.log
  level:
    cn.iocoder.zhgd.module.bpm.dal.mysql: debug
    cn.iocoder.zhgd.module.infra.dal.mysql: debug
    cn.iocoder.zhgd.module.infra.dal.mysql.logger.ApiErrorLogMapper: INFO
    cn.iocoder.zhgd.module.infra.dal.mysql.job.JobLogMapper: INFO
    cn.iocoder.zhgd.module.infra.dal.mysql.file.FileConfigMapper: INFO
    cn.iocoder.zhgd.module.pay.dal.mysql: debug
    cn.iocoder.zhgd.module.pay.dal.mysql.notify.PayNotifyTaskMapper: INFO
    cn.iocoder.zhgd.module.system.dal.mysql: debug
    cn.iocoder.zhgd.module.system.dal.mysql.sms.SmsChannelMapper: INFO
    cn.iocoder.zhgd.module.tool.dal.mysql: debug
    cn.iocoder.zhgd.module.member.dal.mysql: debug
    cn.iocoder.zhgd.module.trade.dal.mysql: debug
    cn.iocoder.zhgd.module.promotion.dal.mysql: debug
    cn.iocoder.zhgd.module.statistics.dal.mysql: debug
    cn.iocoder.zhgd.module.crm.dal.mysql: debug
    cn.iocoder.zhgd.module.erp.dal.mysql: debug
    cn.iocoder.zhgd.module.iot.dal.mysql: debug
    cn.iocoder.zhgd.module.iot.dal.tdengine: DEBUG
    cn.iocoder.zhgd.module.iot.service.rule: debug
    cn.iocoder.zhgd.module.ai.dal.mysql: debug
    org.springframework.context.support.PostProcessorRegistrationDelegate: ERROR
debug: false

# ========== 微信配置（公众号+小程序） ==========
wx:
  mp:
    app-id: wxf56b1542b9e85f8a
    secret: 496379dcef1ba869e9234de8d598cfd3
    config-storage:
      type: RedisTemplate
      key-prefix: wx
      http-client-type: HttpClient
  miniapp:
    appid: wxc4598c446f8a9cb3
    secret: 4a1a04e07f6a4a0751b39c3064a92c8b
    config-storage:
      type: RedisTemplate
      key-prefix: wa
      http-client-type: HttpClient

# ========== 芋道自定义配置 ==========
zhgd:
  captcha:
    enable: false
  security:
    mock-enable: true
  pay:
    order-notify-url: https://yutou.mynatapp.cc/admin-api/pay/notify/order
    refund-notify-url: https://yutou.mynatapp.cc/admin-api/pay/notify/refund
    transfer-notify-url: https://yutou.mynatapp.cc/admin-api/pay/notify/transfer
  access-log:
    enable: false
  demo: false
  wxa-code:
    env-version: develop
  wxa-subscribe-message:
    miniprogram-state: developer
  tencent-lbs-key: TVDBZ-TDILD-4ON4B-PFDZA-RNLKH-VVF6E

# ========== JustAuth 第三方登录配置 ==========
justauth:
  enabled: true
  type:
    DINGTALK:
      client-id: dingvrnreaje3yqvzhxg
      client-secret: i8E6iZyDvZj51JIb0tYsYfVQYOks9Cq1lgryEjFRqC79P3iJcrxEwT6Qk2QvLrLI
      ignore-check-redirect-uri: true
    WECHAT_ENTERPRISE:
      client-id: wwd411c69a39ad2e54
      client-secret: 1wTb7hYxnpT2TUbIeHGXGo7T0odav1ic10mLdyyATOw
      agent-id: 1000004
      ignore-check-redirect-uri: true
    WECHAT_MINI_PROGRAM:
      client-id: ${wx.miniapp.appid}
      client-secret: ${wx.miniapp.secret}
      ignore-check-redirect-uri: true
      ignore-check-state: true
    WECHAT_MP:
      client-id: ${wx.mp.app-id}
      client-secret: ${wx.mp.secret}
      ignore-check-redirect-uri: true
    ALIPAY:
      client-id: xx
      client-secret: xx
      alipay-public-key: xx
      ignore-check-redirect-uri: true
      ignore-check-state: true
  cache:
    type: REDIS
    prefix: 'social_auth_state:'
    timeout: 24h
